<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

<h1>APPLY FOR AN API KEY</h1>
<h1>welcome......</h1>
<form action="/newUser" method="post">
      <input type="email" placeholder="email" name="email">
      <input type="text" placeholder="enter website url you intend to use api key for" name="hostname">
      <button>REGISTER</button>
</form>
    <script>

      
        async function view(){
            let res=await fetch('/newUser');
            let json=await res.json().then(e=>{
                console.log(e);
            });
            document.write(JSON.stringify(json))
        }
     
   console.log(2)
   console.log(3)


    </script>
</body>
</html>

<script>
    /*  if(err)throw err;
         data=JSON.parse(userBuffer)
         let todaysDate=this.getDate()
         let key=req.headers['apikey'];
        
        let apikey=data.find(user=>{return key==user.key;})
        if(apikey){
           if(apikey.calls[0]==todaysDate){//if you have called the api today
            data.map((user,index)=>{
                 if(data[index].key==key && data[index].calls[1]>0){//if api calls have not reached max
                    data[index].calls[1]--;
                    data[index].calls[0]=todaysDate;
                   fs.writeFile('./apiusers.json',JSON.stringify(data),(err)=>{
                        if(err){
                            throw err;
                        }
                   })
                   next()
                 }
               
              })
              //if you reach max api calls
              if(apikey.calls[1]<1 && apikey.calls[0]==todaysDate){
                res.json({err:'you have reached max number of api calls for today!!!try again tomorrow'})
               }
           }else{
            console.log('first api call today');
                //reset count and change date
            users.map((user,index)=>{
                if(users[index].key==key){
                    users[index].calls[0]=todaysDate;
                    users[index].calls[1]=3;
                    console.log('hi')
                    console.log(data);
                    if(data){
                        fs.writeFile('./apiusers.json',JSON.stringify([user]),(err)=>{
                            if(err){
                                console.log('error')
                                throw err;
                            }
                            console.log('ddd',data)
                        })
                    }else{
                        console.log('cleared')
                    }
                  
                }
            })
            
           }
     
        }else{
         res.status(400).json({err:'you need an api key to access this endpoint'})
        }
      

     


 */
</script>